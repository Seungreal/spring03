<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        table tr th{border:1px solid black}
        table tr td{border:1px solid black}
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>상세보기</h1><br>
    <a id="home" href="#">홈으로</a>
    <a id="list"href="#">목록으로</a>
    <table class="table">
        <thead>
            <tr class="table-active">
                <th style="width: 10%">글번호: <span id="artNum"></span></th>
                <th style="width: 20%">글쓴이ID: <span id="writerId"></span></th>
                <th style="width: 20%">작성일: <span id="regDate"></span></th>
                <th style="width: 10%">조회수: <span id="count"></span></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="4" style="width: 100%; height:30px"><span id="title"></span></td>
            </tr>
            <tr>
                <td colspan="4" style="width: 100%">
                    <div id="content" style="height: 300px;"></div>
                </td>
            </tr>
            <tr id="toggle">
        
            </tr>
        </tbody>
    </table>
    
    <script>
        $('#home').click(e=>{location.href='/'})
        $('#list').click(e=>{location.href='/forms/articles/list'})
        $.getJSON(`/articles/${localStorage.getItem('artNum')}`,d=>{
            $('#artNum').text(d.artNum)
            $('#writerId').text(d.writerId)
            $('#regDate').text(d.regDate)
            $('#count').text(d.count)
            $('#title').text(d.title)
            $('#content').text(d.content)
            $('#toggle').html('<button id="update-btn">수정화면 이동</button><button id="delete-btn">삭제</button>')
            //수정시에만 작동
            $('#update-btn').click(e=>{
                $('#title').html('<input id="update-title" type:"text" value="'+d.title+'">')
                $('#content').html('<textarea id="update-content" style="width: 400px ;height: 250px">'+d.content+'</textarea>')
                $('#toggle').html('<button id="confirm">수정하기</button>')
                $('#confirm').click(e=>{
                    e.preventDefault()
                    $.ajax({
                        url:'/articles',
                        type:'PUT',
                        data:JSON.stringify({
                            artNum: d.artNum,
                            title: $('#update-title').val(),
                            content: $('#update-content').val(),
                        }),
                        dataType:'json',
                        contentType:'application/json',
                        success:d=>{if(d.message==="SUCCESS"){location.href='/forms/articles/detail'}
                                    else{alert('수정 실패')}},
                        error:e=>{}
                    })
                })
            })
            $('#delete-btn').click(e=>{
                $.ajax({
                    url:'/articles',
                    type:'DELETE',
                    data:JSON.stringify({artNum:d.artNum}),
                    dataType:'json',
                    contentType:'application/json',
                    success:d=>{if(d.message==="SUCCESS"){location.href='/forms/articles/list'}
                                else{alert('삭제 실패')}},
                    error:e=>{}
                })
            })
        })
    </script>
</body>
</html>